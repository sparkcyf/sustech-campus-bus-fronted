(function(t){function e(e){for(var n,i,o=e[0],u=e[1],c=e[2],l=0,p=[];l<o.length;l++)i=o[l],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);d&&d(e);while(p.length)p.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,o=1;o<a.length;o++){var u=a[o];0!==r[u]&&(n=!1)}n&&(s.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},s=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="https://cdn.jsdelivr.net/gh/sparkcyf/sustech-campus-bus-project@leaflet/timetable-vue/dist/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=u;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"516c":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("title_bar"),a("Map-container_leafletjs",{ref:"map_container_leafletjs",staticStyle:{width:"100%",height:"500px"}}),a("VuetifyDatatable",{attrs:{posts:t.display_data}})],1)},s=[],i=(a("b0c0"),a("d3b7"),a("25f0"),a("96cf"),a("1da1")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-main",[a("v-container",[a("v-row",{staticStyle:{height:"10px"}}),a("v-row",[a("v-select",{staticStyle:{width:"70%",height:"50px"},attrs:{items:this.$parent.stations,"item-text":"name","item-value":"no",outlined:"",label:"Select the station:"},on:{change:this.$parent.changestation},model:{value:this.$parent.query_string_sta,callback:function(e){t.$set(this.$parent,"query_string_sta",e)},expression:"this.$parent.query_string_sta"}}),a("v-btn",{staticStyle:{width:"30%",height:"55px"},attrs:{depressed:"",color:"primary"},on:{click:this.$parent.refresh}},[t._v(" Refresh ("+t._s(this.$parent.countdown_timer)+") ")])],1),a("v-row",[a("v-col",{attrs:{md:"3"}},[a("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1),a("v-row",[a("v-col",[a("v-data-table",{staticClass:"elevation-1 mytable",attrs:{headers:t.headers,items:t.posts,"items-per-page":5,search:t.search,"sort-by":t.sortBy,"sort-desc":t.sortDesc},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[a("v-icon",{attrs:{small:""},on:{click:function(e){return t.deleteItem(n)}}},[t._v("mdi-delete")])]}},{key:"item.eta_text",fn:function(e){var n=e.item;return[a("v-chip",{attrs:{color:t.getColor(n.eta),dark:""}},[t._v(" "+t._s(n.eta_text)+" ")])]}},{key:"item.peak_text",fn:function(e){var n=e.item;return[a("v-chip",{attrs:{color:t.getColor_peak(n.peak_line),dark:""}},[t._v(" "+t._s(n.peak_text)+" ")])]}}])})],1)],1)],1)],1)],1)},u=[],c=(a("c975"),a("a434"),{props:["posts"],data:function(){return{search:"",sortBy:"eta",sortDesc:!1,headers:[{text:"BUSID",value:"imei"},{text:"DPT_TIME",value:"depart_time_text"},{text:"Type",value:"peak_text"},{text:"Direction",value:"direction_text",sortable:!0},{text:"ETA",value:"eta_text"}],selector_item:["Foo","Bar","Fizz","Buzz"]}},methods:{deleteItem:function(t){var e=this.posts.indexOf((function(e){return e.id===t.id}));this.posts.splice(e,1)},getColor:function(t){var e=t;return e<120?"red":e<600?"orange":"green"},getColor_peak:function(t){return 1===t?"#ed6b00":"#003f43"}}}),d=c,l=(a("5fe8"),a("2877")),p=a("6544"),_=a.n(p),m=a("7496"),h=a("8336"),f=a("cc20"),y=a("62ad"),b=a("a523"),g=a("8fea"),v=a("132d"),w=a("f6c4"),x=a("0fd9"),k=a("b974"),j=a("8654"),O=Object(l["a"])(d,o,u,!1,null,null,null),S=O.exports;_()(O,{VApp:m["a"],VBtn:h["a"],VChip:f["a"],VCol:y["a"],VContainer:b["a"],VDataTable:g["a"],VIcon:v["a"],VMain:w["a"],VRow:x["a"],VSelect:k["a"],VTextField:j["a"]});var C=a("bc3a"),D=a.n(C),T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"map-root",attrs:{id:"map"}})},A=[],H=(a("d81d"),a("6cc5"),a("e11e")),M=a.n(H),R=(a("a8b7"),{name:"MapContainer_leafletjs",data:function(){return{route_geojson:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[113.991474905071,22.5995578639097,0],[113.99120548565,22.5993984442423,0],[113.990871111373,22.5992273583025,0],[113.990438868542,22.5988556202153,0],[113.99035854976,22.5983184780662,0],[113.990303493128,22.597852353438,0],[113.990271122991,22.5974175475434,0],[113.990425827457,22.5970663177642,0],[113.99085177206,22.5970103428823,0],[113.991218154094,22.5971035764697,0],[113.991477615589,22.5971624791277,0],[113.991689350913,22.5972274068443,0],[113.99198242738,22.5972218479079,0],[113.992305377769,22.5970751001672,0],[113.992583721421,22.5968347284597,0],[113.992856148846,22.5965966333275,0],[113.993219208091,22.5962852164537,0],[113.993526964364,22.5961191075337,0],[113.993827831042,22.596039301559,0],[113.99408046156,22.5960208695522,0],[113.994269739751,22.5960271393208,0],[113.994499679455,22.5956490984755,0],[113.994652289657,22.5955650670575,0],[113.994908103167,22.5956958820479,0],[113.995442863651,22.5959672524098,0],[113.995862524707,22.5964753625872,0],[113.996155331924,22.5968400089816,0],[113.996508905698,22.5972321193261,0],[113.996762810774,22.5975319248626,0],[113.99707520964,22.5979217220742,0],[113.99739827277,22.5982820655105,0],[113.997623626077,22.5985155079414,0],[113.997842067804,22.598770149162,0],[113.998102848729,22.5990457211399,0],[113.998465703124,22.5993188035995,0],[113.998784737022,22.599535440221,0],[113.999029309757,22.5996833022418,0],[113.999383415556,22.5998914944798,0],[113.999652017481,22.6000098063961,0],[113.999410925116,22.6002373320928,0],[113.999104809902,22.600493221791,0],[113.998937777688,22.6006840644765,0],[113.998796001197,22.6009384291598,0],[113.998776854973,22.6012017929467,0],[113.99864650783,22.6016030523502,0],[113.998315106153,22.6019902058158,0],[113.998129350408,22.6024249619495,0],[113.998018208685,22.60277812686,0],[113.998035535549,22.6030522036165,0],[113.997810190998,22.6033251501689,0],[113.997148302384,22.603093735691,0],[113.996548834678,22.6029424155087,0],[113.995929987698,22.6029298378861,0],[113.995509076352,22.602953071226,0],[113.995208733913,22.6032174588879,0],[113.994906676935,22.603565797586,0],[113.994463205616,22.6040214237258,0],[113.99404307991,22.6044242709475,0],[113.993742699677,22.6049908103233,0],[113.99345753339,22.6054471667278,0],[113.99410264537,22.605785572167,0],[113.994779724329,22.6061659083821,0],[113.995162622914,22.6063015426974,0],[113.995236382676,22.6065245505898,0],[113.995280185276,22.6067064372239,0],[113.995776639282,22.6066182615105,0],[113.996460302673,22.6063866567717,0],[113.997058597569,22.6061520656827,0],[113.997499869837,22.6059784179845,0],[113.997728308405,22.6059051029878,0],[113.998113538609,22.6060129324337,0],[113.998294754175,22.6060126290703,0],[113.998528950335,22.6062919245772,0],[113.99868406298,22.6067224224212,0],[113.998773343783,22.6072747716093,0],[113.998820377309,22.6076196914398,0],[113.998843576084,22.6078455764574,0],[113.998891483055,22.6081606961109,0],[113.99865284819,22.6085549994136,0],[113.998499955313,22.6089111685076,0],[113.998350628838,22.6092960893901,0],[113.998242850779,22.6095883166435,0],[113.998077085842,22.6098602980525,0],[113.997875477003,22.610146491032,0],[113.997701529791,22.6104875954142,0],[113.997463728329,22.610680644227,0]]},properties:{name:"ctrl-point-downhill",tessellate:!0}}]}}},mounted:function(){this.init_marker(),this.map=M.a.map("map").setView([22.602265,113.994955],15),M.a.tileLayer("https://maps2.cra.moe/maps/streets/{z}/{x}/{y}@2x.png?key=iN1z1bnMdds2aQkYFIpe",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Bus data: SUSTech CS Office</a>',tileSize:512,zoomOffset:-1,crossOrigin:!0}).addTo(this.map),M.a.geoJSON(this.route_geojson).addTo(this.map),this.add_marker(this.$parent.map_display_data)},methods:{init_marker:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new M.a.FeatureGroup;case 2:t.markers=e.sent,console.log("init marker don");case 4:case"end":return e.stop()}}),e)})))()},add_marker:function(t){this.markers.clearLayers();var e,a=M.a.icon({iconUrl:"https://cdn.jsdelivr.net/gh/sparkcyf/sustech-campus-bus-project@master/realtime-location-fronted-1/bus-top-view.svg",iconSize:[48,36],iconAnchor:[24,18],popupAnchor:[-3,-30]}),n=new Date(0);for(e=0;e<t.length;e++)if(1===t[e].tag){var r=void 0;1===t[e].peak_line&&(r="PEAK"),0===t[e].peak_line&&(r="NORMAL");var s=void 0;1===t[e].direction&&(s="JOY HIGHLAND"),2===t[e].direction&&(s="COE"),n.setSeconds(t[e].depart_time);var i=n.toISOString().substr(11,8),o=M.a.marker([t[e].lat,t[e].lng],{icon:a,rotationAngle:t[e].course});o.bindPopup("The IMEI is "+t[e].imei+"<br>ctrl_point is "+t[e].ctrl_point+"<br>The Departure time of the bus is "+i+".<br>The type of line is "+r+".<br>Its ETA is <b>"+Math.round(t[e].eta)+"</b> seconds.<br>Direction: "+s),this.markers.addLayer(o),this.map.addLayer(this.markers)}}}}),V=R,E=a("8023"),$=a.n(E),I=Object(l["a"])(V,T,A,!1,null,"3311998c",null);"function"===typeof $.a&&$()(I);var B=I.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{ref:"title_bar",attrs:{color:"grey lighten-4",flat:"",tile:""}},[a("v-toolbar",{attrs:{dense:""}},[a("v-toolbar-title",[t._v("SUSTech Next Bus")]),a("v-spacer")],1)],1)},P=[],q={name:"title_bar"},Y=q,F=(a("64af"),a("b0af")),G=a("2fa4"),z=a("71d9"),J=a("2a7f"),N=Object(l["a"])(Y,L,P,!1,null,"a3e2bc0a",null),U=N.exports;_()(N,{VCard:F["a"],VSpacer:G["a"],VToolbar:z["a"],VToolbarTitle:J["a"]});var K={name:"App",components:{title_bar:U,VuetifyDatatable:S,MapContainer_leafletjs:B},data:function(){return{posts:[{userId:1,id:1,title:"114514 hen"},{userId:1,id:2,title:"qui est esse"},{userId:1,id:3,title:"ea molestias quasi exercitationem repellat qui ipsa sit aut"}],bus:[{imei:"866005041185986",lat:0,lng:0,speed:-9},{imei:"866005041186018",lat:22.610533,lng:113.997333,speed:0}],bus_remote:[],bus_remote2:[],timetable_jhl_rsb_workday:[],lut_up:[],lut_down:[],current_seconds:0,sta_num_up:0,sta_num_down:95,stations:[{no:0,sta:"COE",up:0,down:95,name:"College of Engineering",name_cn:""},{no:1,sta:"RSB",up:9,down:85,name:"Research Building",name_cn:""},{no:2,sta:"GA7",up:15,down:79,name:"Gate 7",name_cn:""},{no:3,sta:"ADM",up:21,down:71,name:"Administration Building",name_cn:""},{no:4,sta:"GA1",up:31,down:62,name:"Gate 1",name_cn:""},{no:5,sta:"GA3",up:45,down:48,name:"Gate 3",name_cn:""},{no:6,sta:"FAP",up:53,down:40,name:"Guest Houses",name_cn:""},{no:7,sta:"FCT",up:57,down:36,name:"Faculty Cafeteria",name_cn:""},{no:8,sta:"CHC",up:60,down:33,name:"Community Health Service",name_cn:""},{no:9,sta:"SDT",up:66,down:28,name:"Student Dormitories",name_cn:""},{no:10,sta:"HYU1",up:83,down:-1,name:"Hui Yuan (U1)",name_cn:""},{no:11,sta:"LHH",up:98,down:23,name:"Lychee Hill",name_cn:""},{no:12,sta:"CYU",up:89,down:19,name:"Chuang Yuan",name_cn:""},{no:13,sta:"HYU2",up:111,down:14,name:"Hui Yuan (2)",name_cn:""},{no:14,sta:"JHL",up:124,down:1,name:"Joy Highland",name_cn:""}],display_data:[],map_display_data:[],query_string_sta:{no:0,sta:"COE",up:0,down:95,name:"College of Engineering",name_cn:""},countdown_timer:10,bus_direction_data:[{no:0,dest:"Joy Highland"},{no:1,dest:"COE"}]}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,n,r,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.set_station();case 2:return e.next=4,D.a.get("https://bus.sustcra.com/api/v1/bus/timetable/");case 4:return a=e.sent,e.next=7,D.a.get("https://bus.sustcra.com/sample/timetable-jhl-rsb-workday.json");case 7:return n=e.sent,e.next=10,D.a.get("https://bus.sustcra.com/sample/timetable-rsb-jhl-workday.json");case 10:return r=e.sent,e.next=13,D.a.get("https://bus.sustcra.com/sample/lut-up.json");case 13:return s=e.sent,e.next=16,D.a.get("https://bus.sustcra.com/sample/lut-down.json");case 16:return i=e.sent,t.bus_remote2=a.data,t.timetable_up_workday=n.data,t.timetable_down_workday=r.data,t.lut_up=s.data,t.lut_down=i.data,e.next=24,t.changestatus();case 24:t.$refs.map_container_leafletjs.add_marker(t.map_display_data),t.periodically();case 26:case"end":return e.stop()}}),e)})))()},methods:{fetchdata:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D.a.get("https://bus.sustcra.com/api/v1/bus/timetable/");case 2:a=e.sent,t.bus_remote2=a.data;case 4:case"end":return e.stop()}}),e)})))()},changestatus:function(){var t;for(this.display_data=[],t=0;t<this.bus_remote2.length;t++)this.bus_remote2[t].tag>0&&this.bus_remote2[t].depart_seconds<1500&&this.display_data.push(this.bus_remote2[t]);var e=new Date,a=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();this.current_seconds=a;var n,r,s=new Date(0);for(n=0;n<this.display_data.length;n++){var i=0;1===this.display_data[n].direction&&(i=this.lut_up[this.sta_num_up].time-this.lut_up[this.display_data[n].ctrl_point].time),2===this.display_data[n].direction&&(i=this.lut_down[this.sta_num_down].time-this.lut_down[this.display_data[n].ctrl_point].time),this.display_data[n].eta=i}this.map_display_data=this.display_data,console.log("map_display_data defined"),this.get_scheduled_bus(1,this.timetable_up_workday),this.get_scheduled_bus(2,this.timetable_down_workday);var o=[];for(r=0;r<this.display_data.length;r++)this.display_data[r].eta<0||(1===this.display_data[r].direction&&(this.display_data[r].direction_text="JOY HIGHLAND"),2===this.display_data[r].direction&&(this.display_data[r].direction_text="COE"),1===this.display_data[r].peak_line&&(this.display_data[r].peak_text="PEAK"),0===this.display_data[r].peak_line&&(this.display_data[r].peak_text="NORMAL"),this.display_data[r].eta_text=Math.round(this.display_data[r].eta/60)+" min.",s=new Date(0),s.setSeconds(this.display_data[r].depart_time),this.display_data[r].depart_time_text=s.toISOString().substr(11,8),o.push(this.display_data[r]));this.display_data=o,console.log(this.display_data)},get_scheduled_bus:function(t,e){var a;for(a=0;a<e.length;a++)if(e[a].time_sec-this.current_seconds<1800&&e[a].time_sec-this.current_seconds>0){var n={};n.depart_time=e[a].time_sec,n.imei="Not Departure Yet",n.tag=2,n.direction=t,1===e[a].peak&&(n.peak_line=1),0===e[a].peak&&(n.peak_line=0),1===t&&(n.eta=this.lut_up[this.sta_num_up].time+(e[a].time_sec-this.current_seconds)),2===t&&(n.eta=this.lut_down[this.sta_num_down].time+(e[a].time_sec-this.current_seconds)),this.display_data.push(n)}},changestation:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.sta_num_up=e.stations[t].up,e.sta_num_down=e.stations[t].down,console.log("numup"+e.sta_num_up+"numdown"+e.sta_num_down),a.next=5,e.refresh();case 5:case"end":return a.stop()}}),a)})))()},refresh:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.fetchdata();case 2:return e.next=4,t.changestatus();case 4:return e.next=6,t.$refs.map_container_leafletjs.add_marker(t.map_display_data);case 6:t.countdown_timer=10;case 7:case"end":return e.stop()}}),e)})))()},periodically:function(){var t=this;this.countdown_timer>0?setTimeout((function(){t.countdown_timer-=1,t.periodically()}),1e3):(this.refresh(),this.countdown_timer=10,this.periodically())},set_station:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a=0;a<t.stations.length;a++)t.stations[a].sta.toString()===t.$route.query.sta&&(t.sta_num_up=t.stations[a].up,t.sta_num_down=t.stations[a].down,t.query_string_sta.name=t.stations[a].name,t.query_string_sta.no=t.stations[a].no);console.log(t.query_string_sta.no);case 1:case"end":return e.stop()}}),e)})))()}}},Q=K,W=Object(l["a"])(Q,r,s,!1,null,null,null),X=W.exports,Z=a("ce5b"),tt=a.n(Z);a("bf40");n["default"].use(tt.a);var et={},at=new tt.a(et),nt=a("8c4f");n["default"].use(nt["a"]);var rt=[{path:"/",name:"Home",component:X}],st=new nt["a"]({mode:"history",base:"https://cdn.jsdelivr.net/gh/sparkcyf/sustech-campus-bus-project@leaflet/timetable-vue/dist/",routes:rt}),it=st;n["default"].use(nt["a"]),n["default"].config.productionTip=!1,new n["default"]({vuetify:at,router:it,render:function(t){return t(X)}}).$mount("#app")},"5fe8":function(t,e,a){"use strict";a("7233")},"64af":function(t,e,a){"use strict";a("516c")},7233:function(t,e,a){},8023:function(t,e){}});
//# sourceMappingURL=app.b7141318.js.map