(function(t){function e(e){for(var n,o,i=e[0],u=e[1],c=e[2],l=0,p=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);d&&d(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,i=1;i<a.length;i++){var u=a[i];0!==s[u]&&(n=!1)}n&&(r.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},s={app:0},r=[];function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var d=u;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("MapContainer",{ref:"map_container"}),a("VuetifyDatatable",{attrs:{posts:t.display_data}})],1)},r=[],o=(a("96cf"),a("1da1")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-main",[a("v-container",[a("h2",[t._v("SUSTech BUS Timetable")]),a("v-row",[t._v(" Where are you? ")]),a("v-row",[a("v-select",{attrs:{items:this.$parent.stations,"item-text":"name","item-value":"no",outlined:"",label:"Select the station:"},on:{change:this.$parent.changestation}})],1),a("v-row",[a("v-col",{attrs:{md:"3"}},[a("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1),a("v-row",[a("v-col",[a("v-data-table",{staticClass:"elevation-1 mytable",attrs:{headers:t.headers,items:t.posts,"items-per-page":5,search:t.search,"sort-by":t.sortBy,"sort-desc":t.sortDesc},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}},scopedSlots:t._u([{key:"item.actions",fn:function(e){var n=e.item;return[a("v-icon",{attrs:{small:""},on:{click:function(e){return t.deleteItem(n)}}},[t._v("mdi-delete")])]}},{key:"item.eta_text",fn:function(e){var n=e.item;return[a("v-chip",{attrs:{color:t.getColor(n.eta),dark:""}},[t._v(" "+t._s(n.eta_text)+" ")])]}},{key:"item.peak_text",fn:function(e){var n=e.item;return[a("v-chip",{attrs:{color:t.getColor_peak(n.peak_line),dark:""}},[t._v(" "+t._s(n.peak_text)+" ")])]}}])})],1)],1)],1)],1)],1)},u=[],c=(a("c975"),a("a434"),{props:["posts"],data:function(){return{search:"",sortBy:"eta",sortDesc:!1,headers:[{text:"BUSID",value:"imei"},{text:"DPT_TIME",value:"depart_time_text"},{text:"Type",value:"peak_text"},{text:"Direction",value:"direction_text",sortable:!1},{text:"ETA",value:"eta_text"}],selector_item:["Foo","Bar","Fizz","Buzz"]}},methods:{deleteItem:function(t){var e=this.posts.indexOf((function(e){return e.id===t.id}));this.posts.splice(e,1)},getColor:function(t){var e=t;return e<120?"red":e<600?"orange":"green"},getColor_peak:function(t){return 1===t?"#ed6b00":"#003f43"}}}),d=c,l=(a("5fe8"),a("2877")),p=a("6544"),_=a.n(p),m=a("7496"),h=a("cc20"),f=a("62ad"),y=a("a523"),b=a("8fea"),v=a("132d"),g=a("f6c4"),w=a("0fd9"),x=a("b974"),k=a("8654"),S=Object(l["a"])(d,i,u,!1,null,null,null),j=S.exports;_()(S,{VApp:m["a"],VChip:h["a"],VCol:f["a"],VContainer:y["a"],VDataTable:b["a"],VIcon:v["a"],VMain:g["a"],VRow:w["a"],VSelect:x["a"],VTextField:k["a"]});var O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"map-root",staticStyle:{width:"100%",height:"400px"},attrs:{id:"map-root"}}),a("div",{ref:"popup",attrs:{id:"popup"}})])},C=[],D=(a("4160"),a("d81d"),a("d3b7"),a("25f0"),a("159b"),a("5bc0"),a("1af9")),M=a("5eee"),T=a("ff80"),H=a("a2c7"),I=a("256f"),A=a("e192"),B=a.n(A),L=a("4cdf"),V=a("f403"),P=a("5831"),R=a("6c77"),E=a("6cbf"),F=a("3e6b"),$={name:"MapContainer",components:{},props:{},mounted:function(){var t=[113.994955,22.602265];B.a.accessToken="pk.eyJ1Ijoic3Bhcmt0b3VyIiwiYSI6ImNrZHZwbzJnaDBvNTgycW5vZXpueTdkbjIifQ.53uysEs1qvK8JXHG-AG7uw";var e=new B.a.Map({style:"mapbox://styles/sparktour/ckld42lo229om17ql4md26mkq",attributionControl:!1,boxZoom:!1,center:t,container:this.$refs["map-root"],doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1}),a=new D["a"]({render:function(t){var n=e.getCanvas(),s=t.viewState,r=a.getVisible();n.style.display=r?"block":"none",n.style.opacity=a.getOpacity();var o=s.rotation;return e.jumpTo({center:Object(I["j"])(s.center),zoom:s.zoom-1,bearing:180*-o/Math.PI,animate:!1}),e._frame&&(e._frame.cancel(),e._frame=null),e._render(),n},source:new T["a"]({attributions:['<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a>','<a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>']})});this.map=new M["a"]({target:this.$refs["map-root"],view:new H["a"]({center:Object(I["c"])(t),zoom:15}),layers:[a]}),this.create_vector_layer(),this.add_bus_to_map(this.$parent.map_display_data)},methods:{create_vector_layer:function(){this.vectorLayer=new F["a"]({source:new P["a"]({features:[]})}),this.map.getLayers().insertAt(0,this.vectorLayer),console.log("init vector layer done")},clean_bus:function(){var t=this,e=this.vectorLayer.getSource().getFeatures();e.forEach((function(e){t.vectorLayer.getSource().removeFeature(e)})),console.log("clean done")},add_bus_to_map:function(t){var e,a=[];for(e=0;e<t.length;e++)if(1===t[e].tag){var n=new R["b"]({image:new E["a"]({src:"https://cdn.jsdelivr.net/gh/sparkcyf/sustech-campus-bus-project@master/realtime-location-fronted-1/bus-top-view.svg",scale:.05,rotation:t[e].course*(2*Math.PI)/360})}),s=new L["a"]({geometry:new V["a"](Object(I["c"])([t[e].lng,t[e].lat])),name:t[e].imei.toString(),direction:t[e].direction,eta:t[e].eta});s.setStyle(n),a.push(s)}this.clean_bus(),console.log(this.vectorLayer.getSource().getFeatures()),this.vectorLayer.getSource().addFeatures(a),console.log(this.vectorLayer.getSource().getFeatures()),console.log("Add/Update bus done."),console.log(this.map.getLayers().getArray())}}},G=$,Y=Object(l["a"])(G,O,C,!1,null,null,null),z=Y.exports,J=a("bc3a"),U=a.n(J),Z={name:"App",components:{VuetifyDatatable:j,MapContainer:z},data:function(){return{posts:[{userId:1,id:1,title:"114514 hen"},{userId:1,id:2,title:"qui est esse"},{userId:1,id:3,title:"ea molestias quasi exercitationem repellat qui ipsa sit aut"}],bus:[{imei:"866005041185986",lat:0,lng:0,speed:-9},{imei:"866005041186018",lat:22.610533,lng:113.997333,speed:0}],bus_remote:[],bus_remote2:[],timetable_jhl_rsb_workday:[],lut_up:[],lut_down:[],current_seconds:0,sta_num_up:124,sta_num_down:1,stations:[{no:1,sta:"COE",up:0,down:95,name:"College of Engineering",name_cn:""},{no:1,sta:"RSB",up:9,down:85,name:"Research Building",name_cn:""},{no:2,sta:"GA7",up:15,down:79,name:"Gate 7",name_cn:""},{no:3,sta:"ADM",up:21,down:71,name:"Administration Building",name_cn:""},{no:4,sta:"GA1",up:31,down:62,name:"Gate 1",name_cn:""},{no:5,sta:"GA3",up:45,down:48,name:"Gate 3",name_cn:""},{no:6,sta:"FAP",up:53,down:40,name:"Guest Houses",name_cn:""},{no:7,sta:"FCT",up:57,down:36,name:"Faculty Cafeteria",name_cn:""},{no:8,sta:"CHC",up:60,down:33,name:"Community Health Service",name_cn:""},{no:9,sta:"SDT",up:66,down:28,name:"Student Dormitories",name_cn:""},{no:10,sta:"HYU1",up:83,down:-1,name:"Hui Yuan (U1)",name_cn:""},{no:11,sta:"LHH",up:98,down:23,name:"Lychee Hill",name_cn:""},{no:12,sta:"CYU",up:89,down:19,name:"Chuang Yuan",name_cn:""},{no:13,sta:"HYU2",up:111,down:14,name:"Hui Yuan (2)",name_cn:""},{no:14,sta:"JHL",up:124,down:1,name:"Joy Highland",name_cn:""}],display_data:[],map_display_data:[]}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U.a.get("https://bus.sustcra.com/api/v1/bus/timetable/");case 2:return a=e.sent,e.next=5,U.a.get("https://bus.sustcra.com/sample/timetable-jhl-rsb-workday.json");case 5:return n=e.sent,e.next=8,U.a.get("https://bus.sustcra.com/sample/timetable-rsb-jhl-workday.json");case 8:return s=e.sent,e.next=11,U.a.get("https://bus.sustcra.com/sample/lut-up.json");case 11:return r=e.sent,e.next=14,U.a.get("https://bus.sustcra.com/sample/lut-down.json");case 14:return o=e.sent,t.bus_remote2=a.data,t.timetable_up_workday=n.data,t.timetable_down_workday=s.data,t.lut_up=r.data,t.lut_down=o.data,e.next=22,t.changestatus();case 22:t.$refs.map_container.add_bus_to_map(t.map_display_data);case 23:case"end":return e.stop()}}),e)})))()},methods:{fetchdata:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U.a.get("https://bus.sustcra.com/api/v1/bus/timetable/");case 2:a=e.sent,t.bus_remote2=a.data;case 4:case"end":return e.stop()}}),e)})))()},changestatus:function(){var t;for(this.display_data=[],t=0;t<this.bus_remote2.length;t++)this.bus_remote2[t].tag>0&&this.bus_remote2[t].depart_seconds<1500&&this.display_data.push(this.bus_remote2[t]);var e,a,n=new Date,s=n.getSeconds()+60*n.getMinutes()+3600*n.getHours();for(this.current_seconds=s,e=0;e<this.display_data.length;e++){var r=0;1===this.display_data[e].direction&&(r=this.lut_up[this.sta_num_up].time-this.lut_up[this.display_data[e].ctrl_point].time),2===this.display_data[e].direction&&(r=this.lut_down[this.sta_num_down].time-this.lut_down[this.display_data[e].ctrl_point].time),this.display_data[e].eta=r}this.map_display_data=this.display_data,console.log("map_display_data defined"),this.get_scheduled_bus(1,this.timetable_up_workday),this.get_scheduled_bus(2,this.timetable_down_workday);var o=[];for(a=0;a<this.display_data.length;a++)if(this.display_data[a].eta<0);else{1===this.display_data[a].direction&&(this.display_data[a].direction_text="JOY HIGHLAND"),2===this.display_data[a].direction&&(this.display_data[a].direction_text="COE"),1===this.display_data[a].peak_line&&(this.display_data[a].peak_text="PEAK"),0===this.display_data[a].peak_line&&(this.display_data[a].peak_text="NORMAL"),this.display_data[a].eta_text=Math.round(this.display_data[a].eta/60)+" min.";var i=new Date(0);i.setSeconds(this.display_data[a].depart_time),this.display_data[a].depart_time_text=i.toISOString().substr(11,8),o.push(this.display_data[a])}this.display_data=o,console.log(this.display_data)},get_scheduled_bus:function(t,e){var a;for(a=0;a<e.length;a++)if(e[a].time_sec-this.current_seconds<1800&&e[a].time_sec-this.current_seconds>0){var n={};n.depart_time=e[a].time_sec,n.imei="Not Departure Yet",n.tag=2,n.direction=t,1===e[a].peak&&(n.peak_line=1),0===e[a].peak&&(n.peak_line=0),1===t&&(n.eta=this.lut_up[this.sta_num_up].time+(e[a].time_sec-this.current_seconds)),2===t&&(n.eta=this.lut_down[this.sta_num_down].time+(e[a].time_sec-this.current_seconds)),this.display_data.push(n)}},changestation:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.sta_num_up=e.stations[t].up,e.sta_num_down=e.stations[t].down,console.log("numup"+e.sta_num_up+"numdown"+e.sta_num_down),a.next=5,e.fetchdata();case 5:return a.next=7,e.changestatus();case 7:e.$refs.map_container.add_bus_to_map(e.map_display_data);case 8:case"end":return a.stop()}}),a)})))()}}},q=Z,N=Object(l["a"])(q,s,r,!1,null,null,null),W=N.exports,K=a("ce5b"),X=a.n(K);a("bf40");n["default"].use(X.a);var Q={},tt=new X.a(Q);n["default"].config.productionTip=!1,new n["default"]({vuetify:tt,render:function(t){return t(W)}}).$mount("#app")},"5fe8":function(t,e,a){"use strict";a("7233")},7233:function(t,e,a){}});
//# sourceMappingURL=app.518fc249.js.map